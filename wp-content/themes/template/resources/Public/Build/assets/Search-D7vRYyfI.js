import"./vue-CKtoRZ9t.js";import{a as m}from"./axios-DmypytPv.js";import{d as w}from"./debounce-CL13jJhr.js";import{d as b}from"./html-entities-By1izw7w.js";import{o as O}from"./vue3-i18n-BciIOh6k.js";import{l as g}from"./lodash-BcXyp3g9.js";import{m as Q,s as E,g as R}from"./lodash-es-_ekPNWve.js";import{r as l,m as j,w as f,l as I,n as C,R as H,d as N,a3 as U,o as u,c as d,a as h,y as _,K as p,I as v,T as S,ah as k,H as T,E as y,P as D,Q as A,M as c,F,a5 as $}from"./@vue-CmjbQV9c.js";import{E as q}from"./element-plus-B348ikMR.js";import{_ as x}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@popperjs-ZR8ENQL4.js";import"./@element-plus-D6theBpo.js";import"./@vueuse-WkX6J78R.js";const J={en:{cookies:{button:{accept:"Accept",close:"Close"},info:{disabled:"Please enable cookies to view this content"}}}};O({locale:"en",messages:J});function M(t){return e=>Object.keys(t).reduce((s,i)=>{const a=typeof t[i]=="object"&&t[i]!=null&&!Array.isArray(t[i])?t[i]:{type:t[i]};return e&&i in e?s[i]={...a,default:e[i]}:s[i]=a,s},{})}const z=t=>{const e=t.split("&"),s={};for(const i of e){let[r,a]=i.split("=").map(decodeURIComponent);if(a&&a.length)if(a.startsWith("[")&&a.endsWith("]")&&(a=JSON.parse(a)),g.has(s,r)){const o=g.get(s,r);Array.isArray(o)?o.push(a):g.setWith(s,r,[o,a],Object)}else g.setWith(s,r,a,Object)}return s},P=(t,e="")=>{let s=Object.entries(t).filter(([i,r])=>i&&r).map(([i,r])=>{if(Array.isArray(r)){const a=[];if(Object.entries(r).forEach(([o,n])=>{if(typeof n=="object")return P(n,`${e}${i}.`);a.push(n)}),a.length)return[e+i,`[${a.join(",")}]`].map(encodeURIComponent).join("=")}else return typeof r=="object"?P(r,`${e}${i}.`):[e+i,r].map(encodeURIComponent).join("=")}).join("&");for(;s.indexOf("&&")!==-1;)s=s.replace(/&&/g,"&");return s.charAt(0)==="&"&&(s=s.slice(1)),s};function G(t,e,s=!1){if(!t||!window.history)return;const i=window.history.state||{},r=s?`${window.location.origin+window.location.pathname}?${P(e)}`:window.location.href;i[t]=JSON.parse(JSON.stringify(e)),history.replaceState(i,document.title,r)}function B(){if(!window.location.search.length)return;const t=window.location.search.charAt(0)==="?"?window.location.search.slice(1):window.location.search;return z(t)}const W=M({getItemsUrl:{type:String,required:!0},getItemsContentUrl:{type:String,default:""},getSolrResultsUrl:{type:String,default:""},paginationType:{type:String,default:"load-more-btn",validator:t=>["load-more-btn","pagination"].includes(t)},initialSearchQuery:{type:String,default:""},itemsPerPage:{type:Number,default:1},type:{type:String,default:"fetch",validator:t=>["fetch","search"].includes(t)}});class Y{constructor(e,s={}){this.initialData=JSON.parse(JSON.stringify(e)),this.data=H(e)}resetFilter(e){e?E(this.data,e,JSON.parse(JSON.stringify(R(this.initialData,e)))):Object.assign(this.data,JSON.parse(JSON.stringify(this.initialData)))}}class K{constructor(e){this.currentPage=l(1),this.end=l(0),this.itemsPerPage=l((e==null?void 0:e.itemsPerPage)??1),this.onSetIndexRange=(e==null?void 0:e.onSetIndexRange)??(()=>{}),this.start=l(0),this.totalItems=l(0),this.type=l((e==null?void 0:e.type)??"load-more-btn"),this.maxPages=I(()=>Math.max(Math.ceil(this.totalItems.value/this.itemsPerPage.value),1)),f(this.currentPage,()=>{this.setIndexRange()})}get isLastPage(){return I(()=>this.end.value>=this.totalItems.value)}isOnCurrentPage(e){return e>=this.start.value&&e<this.end.value}nextPage(){return++this.currentPage.value}reset(){this.currentPage.value}setIndexRange(){switch(this.type.value){case"load-more-btn":this.end.value=Math.min(this.currentPage.value*this.itemsPerPage.value,this.totalItems.value);break;case"pagination":this.start.value=Math.min((this.currentPage.value-1)*this.itemsPerPage.value,this.totalItems.value),this.end.value=Math.min(this.start.value+this.itemsPerPage.value,this.totalItems.value);break}this.onSetIndexRange()}handlePaginationClick(e){this.currentPage.value=Math.min(e,this.maxPages.value)}}class V{constructor(){this.QUERY_LENGTH_THRESHOLD=3,this.lastQuery="",this.isLoading=l(!1),this.query=l(""),this.results=l([]),this.fetchResultsDebounced=w(this.fetchResults,300)}fetchResults(e){if(!(!e||!e.action)&&this.lastQuery!==this.query.value){if(this.query.value.length>=this.QUERY_LENGTH_THRESHOLD){this.isLoading.value=!0;let s=new FormData(e),i=this.query.value,r=m.post(e.action,s);i=i.split(" ").map(o=>"*"+o+"*").join(" "),s.set("tx_solr[q]",i);let a=m.post(e.action,s);Promise.all([r,a]).then(o=>{const n=[];o.forEach(L=>n.push(...L.data.searchResults)),this.results.value=n}).catch(o=>{}).then(()=>{this.isLoading.value=!1})}else this.lastQuery.length>=this.QUERY_LENGTH_THRESHOLD&&(this.results.value=[]);this.lastQuery=this.query.value}}filterItems(e){return this.query.value.length<this.QUERY_LENGTH_THRESHOLD?e:e.filter(s=>this.results.value.find(i=>s.uid===i.uid))}}class X{constructor(e,s){this.filter=new Y(s,e),this.filteredItems=l([]),this.items=l([]),this.isLoading=l(!1),this.lazyLoad=j("lazyLoad"),this.pagination=new K({itemsPerPage:e.itemsPerPage,onSetIndexRange:()=>this.fetchItemsContent(),type:e.paginationType}),this.props=e,this.search=new V,e.urlEncoding&&Q(this.filter.data,B()),f(this.filteredItems,i=>{this.pagination.totalItems.value=i.length,this.pagination.setIndexRange()}),f([this.filter.data,this.search.results],()=>{this.filterItems(),this.pagination.reset(),e.id&&G(e.id,this.filter.data,e.urlEncoding)},{deep:!0}),f(this.search.isLoading,()=>{this.isLoading.value=this.search.isLoading.value}),this.fetchItems()}get visibleItems(){return I(()=>this.filteredItems.value.filter((e,s)=>e.content&&this.pagination.isOnCurrentPage(s)))}addItems(e){e.length&&e.reverse().forEach(s=>{this.items.value.unshift(s)})}fetchItems(){return this.isLoading.value=!0,this.items.value=[],m({url:this.props.getItemsUrl,method:this.props.type==="search"?"post":"get"}).then(e=>{this.addItems(e.data),this.setFilterOptions(),this.filterItems()}).catch(e=>{})}fetchItemsContent(){if(this.props.getItemsContentUrl){let e=this.fetchItemsContentPrepareParams();e.uids.length?(this.isLoading.value=!0,m.get(this.props.getItemsContentUrl,{params:e}).then(s=>{s.data.forEach(i=>{const r=this.items.value.findIndex(a=>i.uid===a.uid);this.items.value[r].content=b(i.content)})}).catch(s=>{}).then(()=>{this.handleItemsLoaded()})):this.handleItemsLoaded()}else this.handleItemsLoaded()}fetchItemsContentPrepareParams(){const e=[];for(let s=this.pagination.start.value;s<this.pagination.end.value;s++)this.filteredItems.value[s].content||e.push(this.filteredItems.value[s].uid);return{uids:e.join(",")}}filterItems(){this.filteredItems.value=this.search.filterItems(this.items.value)}handleItemsLoaded(){this.isLoading.value=!1,C(()=>{this.lazyLoad&&this.lazyLoad.update()})}setFilterOptions(){}}let Z=class extends X{constructor(e,s){super(e,s),this.searchQuery=l(e.initialSearchQuery??""),this.searchQuery.value.length&&this.fetchItems()}fetchItems(){return this.searchQuery?(this.isLoading.value=!0,this.items.value=[],m({url:this.props.getItemsUrl,method:this.props.type==="search"?"post":"get",data:this.props.type==="search"&&this.searchQuery?{query:this.searchQuery.value}:null}).then(e=>{this.addItems(e.data),this.setFilterOptions(),this.filterItems()}).catch(e=>{})):Promise.resolve()}submitSearchForm(e){e.preventDefault();const s=e.target.querySelector('input[type="search"]');s&&(this.searchQuery.value=s.value,this.fetchItems())}};const ee=N({name:"search",components:{"el-pagination":q},props:{...W()},setup(t){return{list:new Z(t,{})}}}),te={class:"d-flex justify-content-center"},se={class:"spinner-border text-primary position-absolute",role:"status"},ie=h("span",{class:"visually-hidden"},"Loading",-1),ae=[ie],re={key:0,class:"search-info-panel"},ne={class:"d-block font-weight-bold"},le={class:"d-block"},oe={key:0,class:"d-block"},he=["innerHTML"],ue={class:"text-center search-pagination"};function ce(t,e,s,i,r,a){const o=U("el-pagination");return u(),d("div",null,[h("form",{class:"search-form",onSubmit:e[0]||(e[0]=(...n)=>t.list.submitSearchForm&&t.list.submitSearchForm(...n))},[_(t.$slots,"search",{searchQuery:t.list.searchQuery.value})],32),h("div",te,[p(S,{name:"fade"},{default:v(()=>[D(h("div",se,ae,512),[[A,t.list.isLoading.value]])]),_:1})]),p(S,{name:"fade"},{default:v(()=>[!t.list.isLoading.value&&t.list.searchQuery.value?(u(),d("div",re,[h("span",ne," Searching for „"+c(t.list.searchQuery.value)+"“… ",1),h("span",le,c(t.list.items.value.length)+" "+c(t.list.items.value.length>1?"results were found.":"result was found."),1),t.list.items.value.length?(u(),d("span",oe," Showing results "+c(t.list.pagination.start.value+1)+" to "+c(t.list.pagination.end.value)+" from "+c(t.list.items.value.length)+". ",1)):y("",!0)])):y("",!0)]),_:1}),p(k,{ref:"listEl",tag:"div",class:"my-2 search-results",name:"arrange"},{default:v(()=>[(u(!0),d(F,null,$(t.list.visibleItems.value,n=>(u(),d("div",{key:n.uid,class:"arrange-item search-results-item",innerHTML:n.content},null,8,he))),128))]),_:1},512),h("div",ue,[t.list.filteredItems.value.length>t.list.pagination.itemsPerPage.value?(u(),T(o,{key:0,total:t.list.filteredItems.value.length,"page-size":t.list.pagination.itemsPerPage.value,"onUpdate:pageSize":e[1]||(e[1]=n=>t.list.pagination.itemsPerPage.value=n),currentPage:t.list.pagination.currentPage.value,"onUpdate:currentPage":e[2]||(e[2]=n=>t.list.pagination.currentPage.value=n),layout:"prev, pager, next"},null,8,["total","page-size","currentPage"])):y("",!0)])])}const Qe=x(ee,[["render",ce]]);export{Qe as default};
